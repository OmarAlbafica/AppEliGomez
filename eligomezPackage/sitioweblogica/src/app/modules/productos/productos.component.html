<div class="space-y-6">
  <!-- Mensajes -->
  <div *ngIf="mensaje" 
       [ngClass]="mensaje.tipo === 'Ã©xito' ? 'bg-green-100 border-green-400 text-green-700' : 'bg-red-100 border-red-400 text-red-700'"
       class="border rounded px-4 py-3">
    {{ mensaje.texto }}
  </div>

  <!-- Modal: Zoom de Imagen -->
  <div *ngIf="mostrarZoom" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-4xl w-full max-h-screen overflow-hidden flex flex-col">
      <div class="flex justify-between items-center p-4 border-b border-gray-300">
        <h3 class="text-xl font-bold text-gray-800">ğŸ” Vista Ampliada</h3>
        <button (click)="cerrarZoom()" class="text-2xl text-gray-600 hover:text-gray-900 font-bold">âœ•</button>
      </div>
      <div class="flex-1 flex items-center justify-center p-4 overflow-auto">
        <img [src]="imagenZoom" alt="Imagen ampliada" class="max-w-full max-h-full object-contain">
      </div>
      <div class="p-4 border-t border-gray-300 text-center text-sm text-gray-600">
        ğŸ’¡ Usa el zoom del navegador (Ctrl + rueda) para ampliar mÃ¡s o haz clic fuera para cerrar
      </div>
    </div>
  </div>

  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">ğŸ–¼ï¸ Productos</h1>
      <p class="text-gray-500 mt-2">GalerÃ­a de imÃ¡genes con cÃ³digos automÃ¡ticos</p>
    </div>
    <button (click)="abrirCargaImagenes()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg transition">
      â¬†ï¸ Cargar ImÃ¡genes
    </button>
  </div>

  <!-- Modal Carga de ImÃ¡genes -->
  <div *ngIf="mostrarCargaImagenes" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-8 max-w-md w-full">
      <h2 class="text-2xl font-bold mb-6">â¬†ï¸ Cargar ImÃ¡genes</h2>

      <!-- Nombre del Ã¡lbum -->
      <div class="mb-4">
        <label class="block text-sm font-medium mb-2">Album (ej: 20251222 o Meses)</label>
        <input [(ngModel)]="albumNombre" 
               type="text" 
               placeholder="20251222 o Meses"
               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500">
      </div>

      <!-- NÃºmero inicial -->
      <div class="mb-4">
        <label class="block text-sm font-medium mb-2">NÃºmero inicial</label>
        <input [(ngModel)]="numeroInicio" 
               type="number" 
               min="1"
               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500">
      </div>

      <!-- SelecciÃ³n de archivos -->
      <div class="mb-6">
        <label class="block text-sm font-medium mb-2">ImÃ¡genes</label>
        <input (change)="onFilesSelected($event)" 
               type="file" 
               multiple 
               accept="image/*"
               class="w-full">
        <p class="text-xs text-gray-500 mt-2">Seleccionadas: {{ archivosCargados.length }} imagen(es)</p>
        <div *ngIf="archivosCargados.length > 0" class="mt-3 p-2 bg-blue-100 rounded text-xs text-blue-800">
          <p>ğŸ“¦ Se comprimira a ~100KB por imagen sin perder calidad notable</p>
          <p class="mt-1" *ngFor="let archivo of archivosCargados">
            â€¢ {{ archivo.name }} ({{ (archivo.size / 1024 / 1024).toFixed(2) }}MB)
          </p>
        </div>
      </div>

      <!-- Progreso -->
      <div *ngIf="procesando" class="mb-4">
        <div class="w-full bg-gray-200 rounded-full h-2">
          <div class="bg-indigo-600 h-2 rounded-full" [style.width.%]="progreso"></div>
        </div>
        <p class="text-xs text-center text-gray-600 mt-2">Procesando... {{ progreso }}%</p>
      </div>

      <!-- Botones -->
      <div class="flex gap-3">
        <button (click)="procesarCarga()" 
                [disabled]="procesando || archivosCargados.length === 0"
                class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-bold disabled:bg-gray-400">
          {{ procesando ? 'â³ Procesando...' : 'âœ… Cargar' }}
        </button>
        <button (click)="mostrarCargaImagenes = false" 
                [disabled]="procesando"
                class="flex-1 bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg font-bold disabled:bg-gray-300">
          âœ• Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal: Confirmar Borrar Ãlbum -->
  <div *ngIf="mostrarModalBorrar && albumABorrar" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
      <h2 class="text-2xl font-bold mb-4 text-red-600">âš ï¸ Borrar Ãlbum</h2>
      
      <p class="text-gray-700 mb-2">Â¿EstÃ¡s seguro de que quieres eliminar el Ã¡lbum?</p>
      <p class="text-xl font-bold text-gray-900 mb-4 p-3 bg-red-50 border-2 border-red-300 rounded-lg">
        "{{ albumABorrar }}"
      </p>
      
      <p class="text-sm text-gray-600 mb-4">
        Se eliminarÃ¡n <strong>{{ contarProductosDelAlbum(albumABorrar || '') }}</strong> imagen(es) de este Ã¡lbum.
      </p>

      <div class="flex gap-3">
        <button (click)="borrarAlbum()" 
                [disabled]="borrando"
                class="flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-bold disabled:bg-gray-400">
          {{ borrando ? 'â³ Borrando...' : 'ğŸ—‘ï¸ Borrar' }}
        </button>
        <button (click)="cerrarModalBorrar()" 
                [disabled]="borrando"
                class="flex-1 bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg font-bold disabled:bg-gray-300">
          âœ• Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="bg-white rounded-lg shadow p-6">
    <h3 class="text-lg font-bold mb-4">ğŸ” Filtros y Acciones</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <!-- Filtro por Ãlbum -->
      <div>
        <label class="block text-sm font-medium mb-2">ğŸ“š Ãlbum</label>
        <select [(ngModel)]="albumSeleccionado" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 outline-none">
          <option value="todos">âœ¨ Todos los Ã¡lbumes</option>
          <option *ngFor="let album of albums" [value]="album">{{ album }}</option>
        </select>
      </div>
      
      <!-- Filtro por Reservado/Disponible -->
      <div>
        <label class="block text-sm font-medium mb-2">ğŸ“¦ Estado</label>
        <select [(ngModel)]="filtroReservado" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 outline-none">
          <option value="todos">âœ¨ Todos</option>
          <option value="disponibles">â—‹ Disponibles</option>
          <option value="reservados">â— Reservados</option>
        </select>
      </div>
    </div>

    <!-- BotÃ³n para eliminar Ã¡lbum seleccionado -->
    <div *ngIf="albumSeleccionado !== 'todos'" class="mt-4 pt-4 border-t border-gray-300">
      <button (click)="abrirModalBorrarAlbum(albumSeleccionado)"
              class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-bold transition">
        ğŸ—‘ï¸ Eliminar Ãlbum "{{ albumSeleccionado }}"
      </button>
      <p class="text-xs text-gray-600 mt-2">Se eliminarÃ¡n todas las imÃ¡genes de este Ã¡lbum</p>
    </div>
  </div>

  <!-- GalerÃ­a -->
  <div *ngIf="getProductosFiltrados().length > 0" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4">
    <div *ngFor="let producto of getProductosFiltrados()" 
         class="bg-white rounded-lg shadow hover:shadow-lg transition overflow-hidden relative">
      
      <!-- Badge de Estado -->
      <div class="absolute top-2 left-2 z-10">
        <span [ngClass]="obtenerColorEstado(producto)" 
              class="text-xs font-bold px-2 py-1 rounded-full inline-block">
          {{ obtenerEstadoProducto(producto) }}
        </span>
      </div>
      
      <!-- Imagen -->
      <img [src]="producto.url_thumbnail" 
           alt="{{ producto.codigo }}"
           class="w-full h-56 object-contain cursor-pointer hover:opacity-80 transition bg-gray-50"
           (click)="abrirDetalle(producto)">
      
      <!-- Info -->
      <div class="p-3">
        <p class="font-bold text-sm text-gray-900 truncate">{{ producto.codigo }}</p>
        <p class="text-xs text-gray-600">{{ producto.album }}</p>
        <button (click)="copiarCodigo(producto.codigo)" 
                class="w-full mt-2 bg-indigo-600 hover:bg-indigo-700 text-white text-xs px-2 py-1 rounded font-medium transition">
          ğŸ“‹ Copiar
        </button>
      </div>
    </div>
  </div>

  <!-- Sin productos -->
  <div *ngIf="getProductosFiltrados().length === 0" class="bg-yellow-100 border-2 border-yellow-300 rounded-lg p-6 text-center">
    <p class="text-xl text-yellow-900">ğŸ“­ No hay productos con esos filtros</p>
    <p class="text-gray-600 mt-2">Cambia los filtros o carga mÃ¡s imÃ¡genes</p>
  </div>

  <!-- EstadÃ­sticas -->
  <div *ngIf="productos.length > 0" class="bg-blue-50 border border-blue-300 rounded-lg p-4">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <p class="font-semibold text-blue-900">ğŸ“Š Total de Productos</p>
        <p class="text-lg font-bold text-blue-700">{{ productos.length }}</p>
      </div>
      <div>
        <p class="font-semibold text-blue-900">â—‹ Disponibles</p>
        <p class="text-lg font-bold text-green-600">{{ contarDisponibles() }}</p>
      </div>
      <div>
        <p class="font-semibold text-blue-900">â— Reservados</p>
        <p class="text-lg font-bold text-red-600">{{ contarReservados() }}</p>
      </div>
    </div>
    <p class="text-sm text-blue-800 mt-3">CompresiÃ³n promedio: {{ calcularCompressionPromedio().toFixed(0) }} KB por imagen</p>
  </div>
</div>
